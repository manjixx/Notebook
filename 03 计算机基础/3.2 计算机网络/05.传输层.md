# 一、传输层概述

![传输层概述](./picture/05/传输层概述.png)

- 计算机网络体系结构中的**物理层**，**数据链路层**以及**网络层**共同解决了将主机通过异构网络互联起来所面临的问题，实现了主机到主机之间的通信

- 实际上在计算机网络中进行通信的真正实体是位于通信两端主机中的进程

- 运输层的任务：为运行在不同主机上的应用进程提供直接的通信服务，因此运输层的协议又被称为端到端协议；

- 运输层向高层用户屏蔽了下面网络核心的细节(如网络拓扑、所采用的路由选择协议等)，它是应用进程看见的就好像是两个运输层实体之间有一条端到端的逻辑通信信道

- 根据应用需求的不同，因特网的运输层为应用层提供了两种不同的运输协议：

  - 面向连接的TCP

  - 无连接的UDP   

---

# 二、运输层的端口号、复用与分用的概念

## 1. 运输层端口号

- 计算机上的进程使用进程标识符PID来标志，不同的操作系统使用不同格式的进程标识符

- 为了使运行不同操作系统的计算机应用进程间能够进行网络通信，就必须使用统一的方法对TCP/IP体系的应用进程进行标识。

- TCP/IP体系的运输层使用端口号来区分应用层的不同应用进程

  - 端口号使用16比特表示，取值范围0~65535
    
    - 熟知端口号：0~1023，IANA将这些端口号分配给了TCP/IP体系中最重要的一些应用协议，例如FTP使用21/20，HTTP使用80，DNS使用53

    - 登记端口号：1024~49151，为没有熟知端口号的应用程序使用。使用这类端口号必须在IANA按照规定的手续登记，以防止被重复。

    - 短暂端口号：49152~65535，留给客户进程选择短暂使用，当服务器进程收到客户进程报文时，就知道了客户进程所使用的动态端口号。通信结束后，这个端口号可供其他客户进程以后使用

  - 端口号只具有本地意义，即端口号只是为了标识本计算机应用层中的各进程，在因特网中，不同计算机中的相同端口号是没有联系的

## 2. 发送方的复用和接收方的分用

![运输方的复用和接收方的分用](./picture/05/运输方的复用和接收方的分用.png)

- 复用和分用纯粹是一种逻辑概念。当用户很多，而资源不足的时候，我们就会重复使用并且彼此分享，而对行为做定义，就引发了2个新概念。

- 复用：多个用户使用一个IO资源 发送消息 时，我们称之为“复用”。

- 分用：多个用户使用一个IO资源 接收消息 时，我们称之为 “分用” 。

- 计算机网络中复用和分用的实例

  - 在网路层，局域网内多个主机利用一个路由网关发送消息给互联网的其他主机。这也是复用技术。同理，利用网关接收路由数据报就叫分用技术。

  - 在运输层，操作系统的多个进程（这里一个端口表示一个进程） 利用一个运输层协议（或者称为运输层接口）发送数据称为复用；同理，接收时叫做 分用。

  - 在应用层，操作系统的多个线程 利用一个端口（或者叫socket,socket = IP+端口号 ）发送消息称为“复用”（有一个技术名词“IO多路复用”讲的大概就是这个意思）同理，接收时叫分用

## 3. TCP/IP体系的应用层常用协议所使用的运输层熟知端口号

![运输层熟知端口号](./picture/05/运输层熟知端口号.png)

---

# 三、TCP和UDP的对比

---

# 四、TCP流量控制

- 流量控制(flow control)：让发送方的发送速率不要太快，要让接收方来得及接收

- TCP连接上利用滑动窗口机制可以很方便的实现对发送方的流量控制
  - TCP接收方利用自己接收窗口的大小来限制发送方的发送窗口大小。
  ![流量控制](./picture/05/流量控制.png)   
  - TCP发送方接收方的零窗口通知后，应启动持续计时器。持续计时器超时后向接收方发送零窗口探测报文
  ![零窗口探测报文](./picture/05/零窗口探测报文.png)   

---

# 五、TCP的拥塞控制

- 在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏，这种情况就称为拥塞
  - 在计算机网络中的链路容量(即带宽)、交换节点中的缓存和处理机等，都是网络的资源

- 若出现拥塞而不进行控制，整个网络吞吐量将随输入负荷的增加而下降

- TCP拥塞控制的四种算法：
  - 慢开始(slow-start)
  - 拥塞避免(congestion avoidance)
  - 快重传(fast retransmit)
  - 快恢复(fast recovery) 

- 假定条件
  - 数据是单向传递，而另一个方向只传送确认
  - 接收方总有足够大的缓存空间，因而发送方发送窗口的大小由网络的拥塞程度来决定
  - 以最大报文段MSS的个数为讨论问题的单位，而不是以字节为单位。   

---

# 六、TCP超时重传时间的选择

---

# 七、TCP可靠传输的实现

---

# 八、TCP的运输连接管理

## 5.8.1 TCP连接的建立


## 5.8.2 TCP连接的释放

---

# 九、TCP报文段的首部格式

---