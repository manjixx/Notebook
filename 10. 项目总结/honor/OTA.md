
# 一、OTA 服务概述

## 1.1 常见缩略语

- OTA(Over the Air): 在线更新服务

- HOTA(Honor Over The Air): XX在线更新服务
	- TUS(Terminal  Unified Portal Server): 终端升级管理服务器
	- TQS(Terminal Query Server): 终端升级查询服务器
	- TDS(Terminal  Download Server): 终端升级下载服务器

- COTA(Customization Over The Air): 定制在线更新服务
  - CPS(Cota protal Service): Cota前端门户服务
  - CQS(Cota Query Service): Cota 业务查询服务

- POTA(Plugin Over the Air):插件在线更新服务

- ECOTA(Enterprise Customization Over the Air):企业定制在线服务 

- BQS(Baseline Version Query Service):BL泳道及版本查询服务

- BMS(Baseline Manage Server):BL泳道及版本管理服务

- CABE(Customization Asset Backend):定制资产(应用)后端服务，用于承载独立更新的应用

- CDN (Content Delivery Network): 内容分发网络
  
   CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术。


# 二、OTA技术架构

## 2.1 基本概念

> **架构定义**
- 架构的定义：计算机系统的软件架构是构建这个系统所需要的一组结构，包括软件元素、结构之间的关系以及两者的属性

  ![架构框架-4+1视图](https://pic1.zhimg.com/v2-94ca5668b9e3221c723363855e92c718_1440w.jpg?source=172ae18b)

> **架构重要的原因**
- 应用程序两个层面的需求
  - 功能性需求，这些需求决定一个应用程序能做什么，功能性需求可以通过任意的架构来实现，甚至是一个单体应用;
  - 非功能性需求（质量属性需求）：非功能性需求决定一个程序的运行时质量，比如可拓展性和可靠性，也决定了开发阶段的质量，包括可维护性，可测试性，可部署性。

## 2.2 常见架构风格


- 架构模式：针对在特定情境下软件架构上的常见问题，通用性，可复用的解决方案。

- 架构风格：一组协作的架构约束，这些约束限制了架构元素的角色和功能，以及在任何一个遵循该风格的架构中允许存在的元素之间的关系，**架构风格即约束**。
  
> **常见的架构模式和架构风格**
- 常见的架构模式和架构风格
  - 数据流系统——批处理，管道 - 过滤器
  - 调用 - 返回系统——主程序和子程序，面向对象系统，分层
  - 独立组件——通信过程，事件系统
  - 虚拟机——解释器，基于规则的系统
  - 以数据为中心的系统（仓库）——数据库，超文本系统，黑板

  ![架构模式与架构风格](https://segmentfault.com/img/bVbifcZ?w=858&h=717)

### 2.2.1 数据流风格(Data Flow Architecture)

> **批处理序列(Batch Sequential)**
  	
- 批处理序列是一种经典的数据处理模型，其中数据转换子系统只有在其前一个子系统完全通过后才能启动其过程，数据流将一批数据作为一个整体从一个子系统传送到另一个子系统。模块之间的通信是通过临时中间文件进行的，这些文件可以被后续子系统删除。适用于数据批量化，各子系统读取相关输入文件，写入输出文件的应用。
	![批处理序列]()	 	
 	
- 优缺点：
	- 优点：在子系统上提供更简单的划分；每个子系统可以是处理输入数据并产生输出数据的独立程序
	- 缺点：高延迟和低吞吐量，不提供并发和交互界面，实施需要外部控制

> **管道-过滤器(Pipe and Filter Architecture)**

- 每个构件都有一组输入和输出,构件读输入的数据流,经过内部处理,然后产生输出数据流。这里构件被称为过滤器，连接件就是数据流传输的管道，将一个过滤器的输出传到另一个过滤器的输入
	![管道-过滤器]()	 

- 优缺点
	- 优点：构建高内聚，低耦合；功能可以通过简单的行为合成实现；复用性高，维护和增强系统简单。新的过滤器替换老的过滤器即可
	- 缺点：不适合交互式的应用；数据传输上没有通用的标准，每个过滤器都增加了解析和合成数据的动作，导致了系统性能的下降 	


### 2.2.2 仓库风格(Data Flow Architecture)

- 仓库（repository）风格中，有两种不同的构件：中央数据结构说明当前状态，独立构件在中央数据存储上执行。一方面，若构件控制共享数据，则仓库是一传统型数据库；另一方面，若中央数据结构的当前状态触发进程执行的选择。

- 黑板系统：黑板系统是一种问题求解模型，是组织推理的步骤、控制状态数据和问题求解之领域知识的概念框架，它将问题的解空间组织成一个或多个应用相关的分级结构。分级结构的每一层信息由一个唯一的词汇来描述，它代表了问题的部分解。

	- 1. 知识源：包含独立的、与应用程序相关的知识，知识源之间不直接进行通讯，它们之间的交互只通过黑板来完成
	- 2. 黑板数据结构：按照与应用程序相关的层次来组织并解决问题的数据，知识源通过不断地改变黑板数据来解决问题
	- 3. 控制：完全由黑板的状态驱动，黑板状态的改变决定了需要使用的特定知识

黑板系统的典型应用是信号处理领域，如网络信息检索、电子商务、自动控制、办公自动化、商业管理智能决策、语音和模式识别、智能控制领域等

### 2.2.3 架构风格与架构模式的区别
 
架构模式是架构风格中的实际应用

- CS结构风格：
	- Server组件提供了一组服务,并监听对这些服务的请求；
	- Client组件通过一个连接器将请求发送到Server,希望执行一个服务
	- Server可以拒绝这个请求,也可以执行这个请求并将响应发送回Client

- 三层架构模式
	- Presentation tier 展现层
	- Logic tier 业务逻辑层
	- Data access tier 数据访问层

	
- CS架构风格，可以看到此架构风格后面有个阐述「2-tier, 3-tier, n-tier exhibit this style」，意思是两层架构、三层架构、n层架构都是CS架构风格的一种表现形式。三层架构模式比CS架构风格更具体，描述了每一层的作用。当系统有如下需求时，就可以考虑三层架构：
	- 需要提供用户界面（不论是本地应用这样的富客户端、还是浏览器，亦或手机APP）
	- 需要访问持久层数据
	- 解耦（视图，业务、数据可独立进化）
 	

# 三、OTA开发框架风格

## 3.1 现有开发框架风格

- struts + Spring + Servlet + NUWA

- 表现层：包含实现用户界面或外部API的代码
- 业务逻辑层：包含业务逻辑
- 数据持久化层：实现与数据库的交互逻辑

> **缺点**
- 单个表现层：它无法展现应用程序可能不仅仅由单个系统调用的事实
- 单一数据持久化层：无法展现应用程序可能与多个数据库进行交互的事实
- 将业务逻辑定义为依赖于持久化层：理论上这样的依赖性会妨碍你在没有数据库的情况下测试业务逻辑

## 3.2 微服务化架构风格

> **基本概念**

通过将一个应用程序设计构建为一组松散耦合的协作服务。每个服务都实现了一部分的相关功能

> **特点**

- 每个服务都容易被取代
- 服务是以能力来组织的，例如用户界面、前端、推荐系统、账单或是物流等。
- 由于功能被拆成多个服务，因此可以由不同的编程语言、数据库实现。
- 架构是对称而非分层（即生产者与消费者的关系）。
- 去中心化数据管理：只管理和维护自己的数据，相互之间互不直接访问彼此的数据，只通过API来存取数据。
- 基础设施自动化：每个微服务应该关注于自己的业务功能实现，基础设施应该尽量自动化——构建自动化、测试自动化、部署自动化、监控自动化。
- 为应对失败而设计：设计之初就要考虑高可靠性和灾难恢复并考虑如何着手进行错误监测和错误诊断。
- 演进式设计：没有完美的架构，唯一不变的是变化。要善于应对变化，容易改变其设计和实现，因为其小，故而易变。

> **优缺点**

- 优点：
	- 支持大型复杂应用程序的持续交付和部署
		- 更好的可测试性 - 测试服务更小，速度更快；
		- 更好的可部署性 - 可以独立部署服务；
		- 能够围绕多个自动团队组织开发工作。
	- 每个微服务的代码规模更小
		-	使开发人员更容易理解和开发；
		-	开发人员的在使用IDE时更加高效；
		-	应用程序启动速度更快，加快了部署速度。
	-	改善了整个应用体系的故障隔离能力
	-	消除对技术堆栈的长期绑定

- 缺点
	- 服务拆分和定义是一项挑战
	- 分布式系统的额外复杂性
		-	开发工具没有针对分布式系统的特定支持；
		-	集成测试更加困难；
		-	必须实现分布式的通信机制；
		-	处理分布式事务的复杂度；
		-	要处理多个开发团队之间的协调工作。
	-	部署的复杂性
		-	容器化部署的复杂性；
		-	容器编排和服务治理的复杂性；
		-	需要更多公共服务的支持，例如服务发现，服务指标监控等。

> **平台比较**
- 微服务
- Spring Cloud与Netflix OSS
- Kubernets
  
## 3.3 DDD(Domain-Driven Design)

### 3.3.1 概念

DDD 全称是 Domain-Driven Design，中文叫领域驱动设计，是一套应对复杂软件系统分析和设计的面向对象建模方法论。


### 3.3.2 软件架构模式的演进

![软件架构模式的演进](https://img-blog.csdnimg.cn/20200803160907795.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p4enp4enp4ejEyMw==,size_16,color_FFFFFF,t_70)

- 第一阶段：单机架构，采用面向过程的设计方法，系统包括客户端 UI 层和数据库两层，采用 C/S 架构模式，整个系统围绕数据库驱动设计和开发，并且总是从设计数据库和字段开始

- 第二阶段：集中式架构，采用面向对象的设计方法，系统包括业务接入层、业务逻辑层和数据库层，采用经典的三层架构，也有部分应用采用传统的 SOA 架构。这种架构容易使系统变得臃肿，可扩展性和弹性伸缩性差。

- 第三阶段：分布式微服务架构，随着微服务架构理念的提出，集中式架构正向分布式微服务架构演进。微服务架构可以很好地实现应用之间的解耦，解决单体应用扩展性和弹性伸缩能力不足的问题 。


### 3.3.3 为什么DDD适合微服务

- DDD并不是一种技术架构，而是一种划分业务领域范围的方法论

- DDD 包括战略设计和战术设计两部分
	- 战略设计主要从业务视角出发 ，建立业务领域模型，划分领域边界，建立通用语言的限界上下文，限界上下文可以作为微服务设计的参考边界。
	- 战术设计则从技术视角出发 ，侧重于领域模型的技术实现，完成软件开发和落地，包括：聚合根、实体、值对象、领域服务、应用服务和资源库等代码逻辑的设计和实现。
 
 
 - DDD 是一种架构设计方法，微服务是一种架构风格，两者从本质上都是为了追求高响应力，而从 业务视角 去分离应用系统建设复杂度的手段。两者都强调从业务出发，其核心要义是强调根据业务发展，合理划分领域边界，持续调整现有架构，优化现有代码，以保持架构和代码的生命力，也就是我们常说的演进式架构
 - DDD 主要关注：从业务领域视角划分领域边界，构建通用语言进行高效沟通，通过业务抽象，建立领域模型，维持业务和代码的逻辑一致性
 - 微服务主要关注：运行时的进程间通信、容错和故障隔离，实现去中心化数据管理和去中心化服务治理，关注微服务的独立开发、测试、构建和部署
 	

# 四、云计算

## 4.1 什么是云计算？

-  痛点：
	- IT三大基础设施资源：计算(CPU + 内存)、网络、存储
	- 传统IT模式下，资源利用率低、费用昂贵、业务上线时间长、维护周期长

- 早期云计算
	- 就是简单一点的分布式计算，解决任务分发，计算结果合并就好了。也曾经还有一个别名，叫网格计算。
	-  VMware、Virtual PC、GAE、SAE、云盘

- 逐渐成熟的云计算
	
	很多大企业早期可能也只是想解决自己的效率与计算问题，到后来，这些大佬发现，这个能力也可以提供给外部使用，所以，就出现了公共云（public cloud）计算 ，把计算机的计算能力直接放在网上卖出去。

	- 基于网络的提供资源共享的远端服务，共享的软硬件资源和信息按需提供给使用此类资源进行计算和其他业务部署的需求者

	- 虚拟化是云计算基础架构的核心，是云计算发展的基础 

## 4.2 云计算架构

![云计算架构](https://pic3.zhimg.com/80/v2-07b42a077d6ea92d95d0ac7513ec0d86_720w.jpg)

- IaaS (Infrastructure as a Service)，又称I层，基础设施即服务，是最底层的硬件资源，主要包括CPU（计算资源），硬盘（存储资源），还有网卡（网络资源）

- PaaS(Platform as a Service), 又称P层，平台即服务，提供类似操作系统和开发工具的功能，通过互联网为用户提供一整套开发、运行和运营应用软件的支撑平台

- SaaS(Software as a Service),又称S层，软件即服务，通过互联网提供软件服务的软件应用模式。用户不需要再花费大量投资用于硬件、软件和开发，只需要支付一定的租赁费用，就可以享受到相应的服务。

- DaaS(Data as a Service),又称D层，数据即服务，通过获取别人的数据作为自己的服务。

## 4.3 云计算管理平台

通过命令或者基于Web可视化控制面板来管理IaSS云端的资源池(服务器、存储和网络)
![云计算管理平台](https://pica.zhimg.com/v2-6fdd17f5eecc1a05605a6629210cc18a_1440w.jpg?source=172ae18b)
[九大开源云管理平台](https://cloud.tencent.com/developer/news/494035)


