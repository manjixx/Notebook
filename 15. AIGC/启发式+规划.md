
# 项目背景

在手机版本包OTA升级场景下，利用CDN来保障用户升级体验。CDN费用通常采用95带宽计费模式，即按照一个月中每5分钟采样得到的带宽值的第95百分位作为计费带宽。但目前版本发布计划与节奏未进行统一管理，导致CDN带宽利用率低、CDN带宽成本高。因此需要合理地安排发布时间和推送比例，提升带宽利用率进而有效地降低CDN带宽成本。

**目标**：在满足业务约束的前提下，寻找最优的发布时间、分发批次和比例组合，实现：流量在日粒度上均匀分布（逼近均值）

版本信息：

```python
Version(
  vid=0,                      # 版本ID（同一版本的不同批次使用相同的ID）
  batch_size=5,      # 最小批次数
  users=1e6,                   # 用户总数量
  size_gb=2.5,                  # 版本包大小（GB），加权平均（泳道）
  start_time=datetime(2024,5,1)  # 开始发布日期
  end_time=datetime(2024,5,10),     # 截止发布日期   
  period=14，      # 发布周期      
  traffic_pattern=[0.4,0.3,0.2,0.1,0,0,0],  # 15天流量分布模式 k线（Magic系列，数字系列，X系列）                  
)
```

**措施：**

- 调整发布日期
- 自动设定发布批次并调整发布比例

**约束**

- 节假日与周末不可以发布版本
- 开始发布日期可以往后推迟最多3天，其他批次发布日期在避开周末与节假日的前提下尽可能均匀分布，截止日期可以往后延迟最多5天
- 截止日期为空时，截止日期通过发布日期与周期进行计算。
- 调整发布日期时，仅可以调整发布日期位于本月的版本，临近月末的版本某些批次可以安排到下月
- 开始发布的比例<= 1%,其他批次发布比例 <= 1-开始发布比例/batch_size，同版本发布比例总和=1
- 10>=批次数>=5
- 计算总流量时，需要考虑上个月发布版本对本月总流量的影响，比如上个月最后一天发布的版本会对本月流量造成影响

成本计算函数：
本质：每个版本按照 traffic_pattern 和 user * 批次比例，在后续几天分摊流量。

优化算法：遗传算法，并行求解
请输出上述方案的完整python实现，注意遗传算法自己实现不要调用框架包
