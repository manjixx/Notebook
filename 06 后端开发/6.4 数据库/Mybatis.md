# 一、Mybatis基本概念

> **Mybatis是什么**

MyBatis 是一款优秀的持久层框架，**一个半 ORM（对象关系映射）框架**，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及 获取结果集。MyBatis 可以使用简单的 XML 或注解来**配置和映射**原生类型、接口和 Java的POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。

> **为什么说Mybatis是半自动的ORM映射工具**
- Hibernate属于全自动ORM映射工具，使用Hibernate查询关联对象或者关联集合对象时，**可以根据对象关系模型直接获取**，所以它是全自动的。
- Mybatis在查询关联对象或关联集合对象时，**需要手动编写sql来完成**，所以，称之为半自动ORM映射工具。


> **Mybatis如何解决JDBC编程中不足**

|   问题     |   Mybatis解决方案      |
|   ----     |      ----            |
|   数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库连接池可解决此问题。     |      在mybatis-config.xml中配置数据链接池，使用连接池管理数据库连接。 |
|   Sql语句写在代码中造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变 java代码。     |      将Sql语句配置在XXXXmapper.xml文件中与java代码分离 |
|   向sql语句传参数麻烦，因为sql语句的where条件不一定，可能多也可能少，占位符需要和参数一一对应。     |      Mybatis自动将java对象映射至sql语句 |
|   对结果集解析麻烦，sql变化导致解析代码变化，且解析前需要遍历，如果能将数据库记 录封装成pojo对象解析比较方便     |     Mybatis自动将sql执行结果映射至java对象   |

> **Mybatis的优缺点**

- **优点**
  - 基于SQL语句编程，相当灵活，不会对应用程序或者数据库的现有设计造成任何影响，SQL 写在XML里，解除sql与程序代码的耦合，便于统一管理；提供XML标签，支持编写动态 SQL语句，并可重用
  - 与JDBC相比，减少了50%以上的代码量，消除了JDBC大量冗余的代码，不需要手动开关连接
  - 很好的与各种数据库兼容（因为MyBatis使用JDBC来连接数据库，所以只要JDBC支持的数 据库MyBatis都支持）
  - 能够与Spring很好的集成

- **缺点**
  - SQL语句的编写工作量较大，尤其当字段多、关联表多时，对开发人员编写SQL语句的功底 有一定要求
  - SQL语句依赖于数据库，导致数据库移植性差，不能随意更换数据库

> **Mybatis适用场景**

MyBatis专注于SQL本身，是一个足够灵活的DAO层解决方案。对性能的要求很高，或者需求变化较多的项目，如互联网项目，MyBatis将是不错的选择。

> **Hibernate与Mybatis的区别**

- **相同点：** 都是对jdbc的封装，都是持久层的框架，都用于dao层的开发。

- **映射关系不同**
  -  ***MyBatis*** 是一个半自动映射的框架，配置Java对象与sql语句执行结果的对应关系，多表关联关系配置简单；
  - ***Hibernate*** 是一个全表映射的框架，配置Java对象与数据库表的对应关系，多表关联关系配置复杂

- **SQL优化和移植性：**
  - ***Hibernate*** 对SQL语句封装，提供了日志、缓存、级联（级联比 MyBatis 强大）等特性， 此外还提供 HQL（Hibernate Query Language）操作数据库，数据库无关性支持好，但 会多消耗性能。如果项目需要支持多种数据库，代码开发量少，但SQL语句优化困难
  - ***MyBatis*** 需要手动编写 SQL，支持动态 SQL、处理列表、动态生成表名、支持存储过程。 开发工作量相对大些。直接使用SQL语句操作数据库，不支持数据库无关性，但sql语句优 化容易。
- **开发难易程度和学习成本：**
  - ***Hibernate 是重量级框架***，学习使用门槛高，适合于需求相对稳定，中小型的项目，比如： 办公自动化系统
  - ***MyBatis 是轻量级框架***，学习使用门槛低，适合于需求变化频繁，大型的项目，比如：互 联网电子商务系统
 
- **总结**
  -  MyBatis 是一个小巧、方便、高效、简单、直接、半自动化的持久层框架； 
  -  Hibernate 是一个强大、方便、高效、复杂、间接、全自动化的持久层框架。

# 二、Mybatis解析和运行原理
> **Mybatis工作原理**

![Mybatis工作流程](https://segmentfault.com/img/bVbMnUc)
> **Mybatis功能架构**

- **API接口层：** 提供给外部使用的接口API，开发人员通过这些本地API来操纵数据库。接口层一接收到调用请求就会调用数据处理层来完成具体的数据处理。
- **数据处理层：** 负责具体的SQL查找、SQL解析、SQL执行和执行结果映射处理等。它主要的目的是根据调用的请求完成一次数据库操作。
- **基础支撑层：** 负责最基础的功能支撑，包括连接管理、事务管理、配置加载和缓存处理，这些都是共用的东西，将他们抽取出来作为最基础的组件。为上层的数据处理层提供最基础的支撑。

![Mybatis功能架构](https://upload-images.jianshu.io/upload_images/9033085-45f641094a702061.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

# 三、Mybatis数据源与连接池

# 四、Mybatis 缓存

