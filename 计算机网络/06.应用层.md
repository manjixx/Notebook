# 6.1 应用层概述

![应用层概述]()
解决通过应用进程的交互来实现特定网络应用的问题

- 应用层是计算机网络体系结构的最顶层，是设计和建立计算机网络的最终目的。

- 本章学习的原理、协议与实现的知识点
  - 万维网 WWW
  - 域名系统 DNS
  - 动态主机配置协议DHCP
  - 电子邮件
  - 文件传送协议FTP
  - P2P文件共享
  - 多媒体网络应用

# 6.2 C/S(客户/服务器方式)和对等方式(P2P方式)

## 客户/服务器方式

- 客户/服务器方式
  - 客户和服务器是指通信中所涉及的**两个应用进程**
  - 客户/服务器方式描述的是进程之间服务和被服务的关系
  - <font color="red">客服是服务请求方，服务器是服务提供方</font>
  - <font color = "red">服务器总是处于运行状态，并等待客户的服务请求。服务器具有固定的端口号(例如HTTP服务器的默认端口号为80),运行服务的主机也有固定的IP地址</font>
    ![]()

- 万维网WWW，电子邮件、文件传输FTP

- 基于C/S方式的应用服务通常都是服务集中型的
  - 由于C/S是一台服务器需要为多个客户机提供服务，因此会出现服务器计算机跟不上众多客户机请求的情况，因此常用计算机群集构建一个强大的虚拟服务器

## 对等方式(P2P方式)

- P2P方式中，没有固定的服务请求者和服务提供者，分布在网络边缘各端系统中的应用进程是对等的，被称为对等方。对等方之间直接通信，每个对等方既是服务的请求者，又是服务的提供者

- 目前互联网中流行的P2P应用主要包括P2P文件共享、即时通信、P2P流媒体、分布式存储等

- P2P时服务分散型的，服务分散在大量对等计算机中，通常位于住宅、校园和办公室中

- P2P方式的最突出特性之一就是可扩展性，系统每增加一个对等方，即增加服务的提供者又增加了服务的请求者，系统性能不会因为规模的增大而降低。

- P2P方式因为不需要庞大的服务器设施和服务器带宽，因此具有成本上的优势

## 6.3 动态主机配置协议DHCP

### DHCP基本概念

- 动态主机设置协议（英语：Dynamic Host Configuration Protocol，缩写：DHCP），又称动态主机组态协定，提供了一种机制，即即插即用连网，这种机制允许**一台计算机加入新网络时可以自动获取IP地址等网络配置信息而不用手动配置**

- DHCP报文在运输层使用UDP协议封装
  - DHCP客户端使用UDP端口号为68
  - DHCP服务器使用的UDP端口号为67

- DCHP客户在未获得IP地址时，使用地址0.0.0.0

- 在每个网络上都配置一个DHCP服务器会使DHCP服务器数量太多，因此现在是使每个网络至少有一个**DHCP中继代理(通常是一台路由器)**,他配置了DHCP服务器的IP地址信息，作为各网络中计算机与DHCP服务器的桥梁。

### DHCP的工作过程

- DHCP报文
  - DHCP DISCOVER:DHCP发现报文

  - DHCP OFFER:DHCP提供报文

  - DHCP REQUEST: DHCP请求报文

  - DHCP ACK: DHCP确认报文

  - DHCP NACK: DHCP否认报文

  - DHCP RELEASE: DHCP 释放报文

- DHCP工作过程
![]()

### DHCP中继代理

![DHCP中继代理](../picture/DHCP中继代理.png)

## 6.4 域名DNS

### 域名DNS(Domain Name System)

    - DNS报文使用传输层的UDP协议进行封装，端口号为53

### 因特网层次树状结构的域名结构

- 域名结构由若干个分量组成，各分量之间用“点”隔开，分别代表不同级别的域名
    > ... .三级域名. 二级域名. 顶级域名
    > nic.hnust.edu.cn 四级域名.三级域名.二级域名.顶级域名
  - 每一级域名都由**英文字母和数字**组成,不超过63个字符，不区分大小写字母
  - 级别最低的域名写左边，级别**最高的顶级域名写右边**
  - 完整域名不超过255个字符

- 域名系统既不规定一个域名下包含多少个下级域名，也不规定每一级域名代表什么意思

- 各级域名由其上一级域名管理机构管理，而顶级域名由因特网名称与数字地址分配机构ICANN进行管理

- 顶级域名TLD(Top Level Domain)分为以下三类：
  - 国家顶级域名nTLD:采用ISO 3166规定，如cn表示中国，us表示美国，uk表示英国
  - 通用顶级域名gTLD:最常见的7个顶级域名，com(公司企业),net(网络教育机构),org(非营利性组织),int(国际组织),edu(美国教育机构),gov(美国政府部门),mil(美国军事部门)
  - 反向域arpa:用于反向域名解析，即IP地址反向解析为域名

- 在国家顶级域名下注册的二级域名均由该国家自行确定
  
- 我国将二级域名划为以下两类：
  - 类别域名:ac(科研机构),com(公司企业),edu(教育机构),gov(政府部门),net(提供网络服务的机构),org(非营利性组织)),mil(军事部门)
  - 行政区域名:共34个
  
![因特网域名空间](../picture/06/因特网域名空间.png)

### 四种类型的域名服务器

- 域名和IP地址的映射关系必须保存在域名服务器中，供其他所有应用查询，DNS使用分布在全国各地的域名服务器实现域名到IP地址的转换

- 域名服务器可以分为一下四种类型：
  - 根域名服务器
  - 顶级域名服务器
  - 权限域名服务器：负责管理某个区的域名
  - 本地域名服务器：起着代理的作用，会将DNS请求报文转发到上述的域名服务器的等级结构中。

### 域名解析过程

- 递归查询
![递归查询](../picture/06/递归查询.png)

- 迭代查询
![迭代查询](../picture/06/迭代查询.png)

- 高速缓存
  - 为了提高DNS查询效率，在域名服务器中广泛使用了高速缓存，用来存放最近查询过的域名以及从何处获得域名映射的信息记录
  - 域名服务器应为没想内容设置计时器并删除超过合理时间的项
  
## 6.5 文件传动协议FTP(File Transfer Protocol)

### FTP工作协议

- 文件传输协议时因特网上使用最广泛的文件传送协议
  - FTP提供交互式的访问，允许客户指明文件的类型与格式(如指明是否使用ASCII码)，并允许文件具有存取权限(如访问文件的用户必须经过授权，并输入有效的命令)
  - FTP屏蔽了计算机系统的细节，因而适合于异构网络中任意计算机之间传送文件

### FTP的基本工作原理

- FTP客户端和服务器之间要建立以下两个并行的TCP连接
  - 控制连接，整个会话过程期间一直保持打开，用于传送FTP相关控制命令
  - 数据连接，用于文件传输，在每次文件传输时才建立，传输结束就关闭
  - FTP使用TCP端口
    - 默认情况下，FTP使用TCP21端口进行控制连接，TCP 20端口进行数据连接
    - 但TCP20端口建立数据连接与传输模式有关，主动方式使用TCP 20端口，被动方式由服务器和客户端自行协商决定。

## 6.6 电子邮件

### 基本概念

- 电子邮件系统采用**客户/服务器方式**

- 电子邮件系统的三个重要组成构建
  - 用户代理:用户与电子邮件系统的借口，又称为电子邮件客户端软件
  - 邮件服务器：电子邮件系统的基础设施，其功能是发送和接受邮件，同时还要负责维护用户的邮箱
  - 电子邮件所需的协议：邮件发送协议(SMTP)和邮件读取协议(POP3,IMAP)

![]()

- 电子邮件的信息格式 RFC 5322，一个电子邮件有信封和内容两部分，而内容由首部和主体组成

### 电子邮件发送协议-简单邮件传输协议(SMTP)

- SMTP基于TCP连接，端口号为25
- SMTP协议只能传送ASCII代码，而不能传送可执行文件和其他二进制对象

- 为了解决SMTP传输非ASCII码文本的问题，提出了多用途因特网邮件扩展MIME
  - 增加了5个新的邮件首部，这些字段提供了有关邮件主题的信息
  - 定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化
  - 定义了传送编码，可对任何内容格式进行转换，而不被邮件系统改变

- MIME同样面向ASCII字符的HTTP

### 电子邮件读取协议

- 邮局协议POP：POP3是其第三个版本，是因特网正式标准。用户只能以下载并删除方式或下载保留的方式从邮件服务器下载邮件到用户计算机，步云熙用户在邮件服务器上管理自己的邮件(如创建文件夹，对邮件进行分类管理等)

- 因特网邮件访问协议IMAP：IMAP4是是其第四个版本，比POP3强大的邮件读取洗衣，用户在自己计算器上就可以操控邮件服务器中的邮箱。IMAP是一个联机协议

- POP3和IMAP4都采用基于TCP连接的客户/服务器方式。POP3使用熟知端口110，IMAP4使用熟知端口143

### 基于万维网的电子邮件

- 通过浏览器登录(提供用户名和口令)邮件服务器万维网站就可以撰写收发阅读和管理电子邮件，这种工作方式和IMAP很相似，不同的是用户无需安装专门的用户代理程序，只需要通用的万维网浏览器

## 6.7 万维网WWW

### 6.7.1 基本概念

- 万维网(World Wide Web)：并非某种特殊的计算机网络，是一个大规模、联机式的信息存储所，是运行在因特网上的一个分布式应用。是利用网页之间的超链接将不同网站链接成一张逻辑上的信息网

- 万维网浏览器
  - 目前比较流行的浏览器如下：
    Chrome:Blink, FireFox:Gecko, Safari:WebKit, Opera:Blin, Internet Explorer：Trident
  - 浏览器最重要的就是渲染引擎，也就是浏览器内核，负责对网页内容进行解析和显示
    - 不同的浏览器内核对同一网页内容的解析有所不同，因此同一内容在不同浏览器显示效果可能不同
    - 网页编写者需要在不同内核的浏览器中测试网页显示效果

- 统一资源定位符URL:用来指明任何种类资源的位置

> <协议>://<主机>:<端口>/<路径>  <http://www.hnust.cn:80/index.html>

- 万维网的文档
  - 超文本标记语言HMTL(Hyper Text Markup Language):使用多种“标签”来描述网页的结构和内容

  - CSS 层叠样式表(Cascading Style Sheets):修饰内容样式，重在内容样式美化展示上，负责HTML页面中元素的展现及排版

  - JavaScript：一种脚本语言，用来扩展文档交互能力，控制网页行为，使静态的HTML具有一定的交互行为（比如表单提交、动画特效、弹窗等。JavaScript的解释器就是JS引擎，JS引擎是浏览器的一部分。

### 6.7.2 超文本传输协议HTTP(HyperText Transfer Protocol)

#### 定义

  HTTP 全称是超文本传输协议(HyperText Transfer Protocol).HTTP是计算机网络中两点之间传输文字、图片、视频、音频等超文本数据的约定和规范。

#### HTTP1.0

- HTTP1.1

#### HTTP报文格式

- HTTP是面向文本的，其报文中的每一个字段都是一些ASCII码串，并且每个字段的长度都是不确定的

- 请求报文格式

- 响应报文格式

- 状态码

### 6.7.3 Cookie与Session

(<https://www.zhihu.com/question/19786827>)

Session是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中；

Cookie是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现Session的一种方式。

### 6.7.4 万维网缓存与代理服务器

- 万维网缓存又称为Web缓存(Web Cache)，可位于客户机也可位于中间系统上位于中间系统上的Web缓存又称为代理服务器(proxy Server)
