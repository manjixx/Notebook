# 键盘检测实现

- 定义钩子相关代码

```c++
#include "pch.h"
#include "framework.h"
#include "YourApp.h"
#include "YourAppDlg.h"
#include "afxdialogex.h"
#include <Windows.h>

HHOOK g_hHook = NULL; // 钩子句柄
CYourAppDlg* g_pDlg = nullptr; // 指向主窗口的全局指针

LRESULT CALLBACK KeyboardProc(int nCode, WPARAM wParam, LPARAM lParam) {
    if (nCode >= 0) {
        KBDLLHOOKSTRUCT* pKeyboard = (KBDLLHOOKSTRUCT*)lParam;

        // 处理按键按下
        if (wParam == WM_KEYDOWN) {
            int vkCode = pKeyboard->vkCode;
            if (g_pDlg) g_pDlg->UpdateButtonColor(vkCode, RGB(0, 255, 0)); // 绿色
        }

        // 处理按键松开
        if (wParam == WM_KEYUP) {
            int vkCode = pKeyboard->vkCode;
            if (g_pDlg) g_pDlg->UpdateButtonColor(vkCode, RGB(0, 0, 0)); // 黑色
        }
    }

    // 调用下一个钩子
    return CallNextHookEx(g_hHook, nCode, wParam, lParam);
}

```